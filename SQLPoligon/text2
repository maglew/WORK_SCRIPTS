create or replace view vr_iva_transinvcustspecs_doc
(nrn, ncompany, ncrn, nprn, nnomen, nnomencrn, snomen, snomenname, nnommodif, snommodif, snommodifname, nnomnmodifpack, snomnmodifpack, snomnmodifpackname, nnomen_type, ngoodsparty, sgoodsparty, nquant, nquantalt, dbegindate, denddate, ntaxgr, staxgr, nprice, npricemeas, ndiscount, nsumm, nsummwithnds, nmeas_main, smeas_main, nmeas_alt, smeas_alt, nmeas_pack, smeas_pack, npack_quant, snumb, nsum_nds, nsum_ncp, sgroup_name, sgroup_code, group_type_quant, svid_otgr, ntype_zakas)
as

P.RN,
P.COMPANY,
P.CRN,
P.PRN,
D1.RN,
D1.CRN,
D1.NOMEN_CODE,
D1.NOMEN_NAME,
N1.RN,
N1.MODIF_CODE,
substr(FR_NIK_NEW_PRICE_MNEMO(P.COMPANY,n1.rn,HEAD.SHEEPVIEW),1,480),
M1.RN,
PACK1.CODE,
PACK1.NAME,
D1.NOMEN_TYPE,
I.RN,
I.CODE,
fr_nik_new_price_quant(P.COMPANY,'GoodsTransInvoicesToConsumers',P.PRN,n1.rn,p.quant),
fr_nik_new_price_quant(P.COMPANY,'GoodsTransInvoicesToConsumers',P.PRN,n1.rn,p.QUANTALT),
P.BEGINDATE,
P.ENDDATE,
T.RN,
T.CODE,
P.PRICE,
P.PRICEMEAS,
P.DISCOUNT,
fr_nik_new_price_price(P.COMPANY,n1.rn,'GoodsTransInvoicesToConsumers_1', P.SUMMWITHNDS - Round (FR_CALC_TAX(P.COMPANY, VR.Ddocdate, 1, P.SUMMWITHNDS, P.TAXGR, P.QUANT, 1, 'NDS'),2),P.PRN,p.quant),
fr_nik_new_price_price(P.COMPANY,n1.rn,'GoodsTransInvoicesToConsumers_2', P.SUMMWITHNDS,P.PRN,p.quant),
MU4.RN,
MU4.MEAS_MNEMO,
MU5.RN,
MU5.MEAS_MNEMO,
MU31.RN,
MU31.MEAS_MNEMO,
PACK1.QUANT,
TIN.NUMB,
ROUND(FR_CALC_TAX(P.COMPANY, HEAD.DOCDATE, 1, P.SUMMWITHNDS, P.TAXGR, P.QUANT, 1, 'NDS'),2),
ROUND(FR_CALC_TAX(P.COMPANY, HEAD.DOCDATE, 1, P.SUMMWITHNDS, P.TAXGR, P.QUANT, 1, 'NCP'),2),
substr(PKGR_DOC.FR_GET_GROUP_NAME_FOR_DOC(HEAD.JUR_PERS, HEAD.RN,'TRANSINVCUST'/*HEAD.TARIF*/, HEAD.ACCDOC, P.NOMMODIF, P.BEGINDATE, P.ENDDATE),1,250),
substr(PKGR_DOC.FR_GET_GROUP_NAME_FOR_DOC(HEAD.JUR_PERS, HEAD.RN, 'TRANSINVCUST'/*HEAD.TARIF*/, HEAD.ACCDOC, P.NOMMODIF, P.BEGINDATE, P.ENDDATE,2),1,10),
PKGR_DOC.FR_GET_GROUP_TYPE_QUANT(P.NOMMODIF),
DS.CODE, --ssheepview
FR_DIMA_AKT(HEAD.RN)